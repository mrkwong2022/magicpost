(()=>{"use strict";function e(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,c=new Array(t);n<t;n++)c[n]=e[n];return c}function t(t){return function(t){if(Array.isArray(t))return e(t)}(t)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(t)||function(t,n){if(t){if("string"==typeof t)return e(t,n);var c=Object.prototype.toString.call(t).slice(8,-1);return"Object"===c&&t.constructor&&(c=t.constructor.name),"Map"===c||"Set"===c?Array.from(t):"Arguments"===c||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(c)?e(t,n):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var n=document,c="getElementsByClassName",i=function(e){return n.querySelectorAll(e)},r="OK",a="Cancel",o=["dialog","toast","loading","iframe"],s={type:0,mask:!0,maskClose:!0,closebtn:!0,whenBtnClickClose:!0,fixed:!0,anim:"def"},l={extend:function(e,t){var n="object"==typeof t?JSON.parse(JSON.stringify(t)):JSON.parse(JSON.stringify(s));for(var c in e)n[c]=e[c];return n},timer:{},end:{},touch:function(e,t){e.addEventListener("click",(function(e){t.call(this,e)}),!1)}},u=0,d=["wbui"],h=function(e){this.config=l.extend(e),this.view()};h.prototype.view=function(){var e=this,t=e.config,r=n.createElement("div"),a="object"==typeof t.content,s="string"==typeof t.type?t.type:d[0]+"-"+o[t.type||0];e.id=r.id=d[0]+u,r.setAttribute("class",d[0]+" "+s),r.setAttribute("index",u);var l,h,b=(l="object"==typeof t.title,t.title?'<h3 class="wbui-title'+(l?" "+t.title[1]:"")+'">'+(l?t.title[0]:t.title)+"</h3>":""),v=(h="object"==typeof t.closebtn,t.closebtn?'<a class="wbui-close'+(h?" "+t.closetype[1]:"")+'"><i></i></a>':""),f=function(){"string"==typeof t.btn&&(t.btn=[t.btn]);var e,n=(t.btn||[]).length;return 0!==n&&t.btn?(e='<span yes type="1">'+t.btn[0]+"</span>",2===n&&(e='<span no type="0">'+t.btn[1]+"</span>"+e),'<div class="wbui-btn">'+e+"</div>"):""}();if(t.fixed||(t.top=t.hasOwnProperty("top")?t.top:100,t.style=t.style||"",t.style+=" top:"+(n.body.scrollTop+t.top)+"px"),2===t.type&&(t.content='<i></i><i class="wbui-load"></i><i></i><p>'+(t.content||"")+"</p>"),3===t.type){t.content=a?t.content:[t.content||"","auto"];t.content='<iframe scrolling="'+(t.content[1]||"auto")+'" allowtransparency="true" id="'+o[3]+u+'" name="'+o[3]+u+'" onload="this.className=\'\';" class="wbui-load" frameborder="0" src="'+t.content[0]+'"></iframe>'}if(t.skin&&(t.anim="fade"),"msg"===t.skin&&(t.mask=t.closebtn=!1,t.time=2),r.innerHTML=(t.mask?"<div "+("string"==typeof t.mask?'style="'+t.mask+'"':"")+' class="wbui-mask"></div>':"")+'<div class="wbui-main" '+(t.fixed?"":'style="position:static;"')+'><div class="wbui-section"><div class="wbui-child '+(t.skin?"wbui-"+t.skin+" ":"")+(t.className?t.className:"")+" "+(t.anim?"wbui-anim-"+t.anim:"")+'" '+(t.style?'style="'+t.style+'"':"")+">"+b+'<div class="wbui-cont">'+t.content+"</div>"+f+(t.closebtn?v:"")+"</div></div></div>",!t.type||2===t.type){var g=n[c](d[0]+o[t.type]);g.length>=1&&p.close(g[0].getAttribute("index"))}document.body.appendChild(r);var y=e.elem=i("#"+e.id)[0];t.success&&t.success(y),e.index=u++,e.action(t,y)},h.prototype.action=function(e,t){var n=this;e.time&&(l.timer[n.index]=setTimeout((function(){p.close(n.index)}),1e3*e.time));var i=function(){0==this.getAttribute("type")?(e.no&&e.no(),p.close(n.index)):(e.yes&&e.yes(n.index),e.whenBtnClickClose&&p.close(n.index))};if(e.btn)for(var r=t[c]("wbui-btn")[0].children,a=r.length,o=0;o<a;o++)l.touch(r[o],i);if(e.mask&&e.maskClose){var s=t[c]("wbui-mask")[0];l.touch(s,(function(){p.close(n.index,e.end)}))}if(e.closebtn){var u=t[c]("wbui-close")[0];l.touch(u,(function(){p.close(n.index,e.end)}))}e.end&&(l.end[n.index]=e.end)};const p={v:"1.0.5",index:u,open:function(e){return new h(e||{}).index},alert:function(e,t){var n="function"==typeof t,c=l.extend({content:e,btn:r});return c=n?l.extend({yes:t},c):l.extend(t,c),p.open(c)},confirm:function(e,t,n,c){var i="function"==typeof t,o=l.extend({content:e,btn:[r,a]});return o=i?l.extend({yes:t,no:n},o):l.extend(t,o),p.open(o)},toast:function(e,t){var n="function"==typeof t,c=l.extend({type:1,content:e,mask:0,closebtn:0,time:2});return c=n?l.extend({end:t},c):l.extend(t,c),p.open(c)},loading:function(e){var t="function"==typeof e,n=l.extend({type:2,content:0,mask:0,maskClose:0,closebtn:0});return n=t?l.extend({end:e},n):l.extend(e,n),p.open(n)},iframe:function(e,t,n,c){var i="function"==typeof t,r=l.extend({type:3,content:e,mask:0});return r=i?l.extend({yes:t,no:n},r):l.extend(t,r),p.open(r)},close:function(e){var t=i("#"+d[0]+e)[0];t&&(t.innerHTML="",n.body.removeChild(t),clearTimeout(l.timer[e]),delete l.timer[e],"function"==typeof l.end[e]&&l.end[e](),delete l.end[e])},closeAll:function(){for(var e=n[c](d[0]),t=0,i=e.length;t<i;t++)p.close(0|e[0].getAttribute("index"))}};var b={searchResults:[],currentResultIndex:-1,lastSearchText:"",lastSearchOptions:{},init:function(){var e=this;this.bindSaveEvents(),document.querySelector("#wb-search-replace-btn").addEventListener("click",(function(){e.openSearchReplaceDialog()}))},bindSaveEvents:function(){var e=this;document.querySelector("#post").addEventListener("submit",(function(){e.clearHighlight()})),document.querySelector("#publish, #save-post").addEventListener("click",(function(){e.clearHighlight()})),"undefined"!=typeof wp&&wp.autosave&&document.addEventListener("autosave-enable-buttons",(function(){e.clearHighlight()})),void 0!==window.tinymce&&document.addEventListener("tinymce-editor-init",(function(e,t){t.on("SaveContent",(function(e){var t=e.content.replace(/<mark class="wb-search-highlight">(.*?)<\/mark>/g,"$1").replace(/<mark class="wb-search-highlight current">(.*?)<\/mark>/g,"$1");e.content=t}))})),"undefined"!=typeof wp&&wp.data&&wp.data.subscribe&&wp.data.subscribe((function(){wp.data.select("core/editor")&&wp.data.select("core/editor").isSavingPost()&&e.clearHighlight()}))},openSearchReplaceDialog:function(){var e=this,t='\n      <div id="wb-search-replace-dialog" class="wb-search-replace-dialog vscode-style">\n        <div class="search-replace-header">\n          <div class="input-container">\n            <div class="search-input-row">\n              <input type="text" id="wb-search-text" class="wb-form-control" placeholder="'.concat(v("搜索"),'" />\n              <div class="search-actions">\n                <button class="toggle-btn" id="wb-case-sensitive-btn" title="').concat(v("区分大小写"),'">\n                  <span class="toggle-icon">Aa</span>\n                </button>\n                <button class="toggle-btn" id="wb-whole-word-btn" title="').concat(v("全字匹配"),'">\n                  <span class="toggle-icon">\\b</span>\n                </button>\n                <button class="toggle-btn" id="wb-use-regex-btn" title="').concat(v("使用正则表达式"),'">\n                  <span class="toggle-icon">.*</span>\n                </button>\n          </div>\n            </div>\n            <div class="replace-input-row">\n              <input type="text" id="wb-replace-text" class="wb-form-control" placeholder="').concat(v("替换"),'" />\n              <div class="replace-actions">\n                <button class="action-btn" id="wb-search-btn">').concat(v("查找"),'</button>\n                <button class="action-btn" id="wb-replace-btn">').concat(v("替换"),'</button>\n                <button class="action-btn" id="wb-replace-all-btn">').concat(v("全部替换"),'</button>\n              </div>\n            </div>\n            <div class="search-results-info" id="wb-search-results-info" style="display: none;">\n              <span class="result-index"></span>\n              <span class="result-count"></span>\n              <div class="result-navigation">\n                <button class="nav-btn" id="wb-prev-result-btn" title="').concat(v("上一个匹配"),'">\n                  <svg viewBox="0 0 16 16" width="16" height="16">\n                    <path fill="currentColor" d="M5.14 8l5.72-5.72-1.14-1.14L2.86 8l6.86 6.86 1.14-1.14L5.14 8z"></path>\n                  </svg>\n                </button>\n                <button class="nav-btn" id="wb-next-result-btn" title="').concat(v("下一个匹配"),'">\n                  <svg viewBox="0 0 16 16" width="16" height="16">\n                    <path fill="currentColor" d="M10.86 8l-5.72 5.72 1.14 1.14L13.14 8 6.28 1.14 5.14 2.28 10.86 8z"></path>\n                  </svg>\n                </button>\n                <button class="clear-btn" id="wb-clear-results-btn" title="').concat(v("清除搜索结果"),'">\n                  <svg viewBox="0 0 16 16" width="16" height="16">\n                    <path fill="currentColor" d="M8 0c4.42 0 8 3.58 8 8 0 4.42-3.58 8-8 8-4.42 0-8-3.58-8-8C0 3.58 3.58 0 8 0zm3.8 4.2L8 7.99 4.21 4.2l-1.01 1 3.78 3.79-3.77 3.78 1.01 1.01L8 10.01l3.79 3.77 1-1.01-3.78-3.77 3.79-3.79-1-1.01z"></path>\n                  </svg>\n                </button>\n              </div>\n            </div>\n          </div>\n        </div>\n        <div class="search-replace-options">\n          <input type="checkbox" id="wb-case-sensitive" style="display:none;" />\n          <input type="checkbox" id="wb-whole-word" style="display:none;" />\n          <input type="checkbox" id="wb-use-regex" style="display:none;" />\n        </div>\n      </div>\n    ');p.open({type:"wb-search-replace",className:"wbui-search-replace",title:v("搜索替换"),content:t,area:["500px","auto"],mask:!1,success:function(){var t=document.querySelector("#wb-search-replace-dialog");e.searchReplaceHander(t)},end:function(){e.clearHighlight()},no:function(){return e.clearHighlight(),!0}})},searchReplaceHander:function(e){var n=this,c=n.getMCE(),i=e.querySelector("#wb-case-sensitive-btn"),r=e.querySelector("#wb-whole-word-btn"),a=e.querySelector("#wb-use-regex-btn"),o=e.querySelector("#wb-search-btn"),s=e.querySelector("#wb-replace-btn"),l=e.querySelector("#wb-replace-all-btn"),u=e.querySelector("#wb-prev-result-btn"),d=e.querySelector("#wb-next-result-btn"),h=e.querySelector("#wb-clear-results-btn"),b=e.querySelector("#wb-search-text"),f=e.querySelector("#wb-replace-text"),g=e.querySelector("#wb-search-results-info"),y=e.querySelector("#wb-search-results-info .result-index"),w=e.querySelector("#wb-case-sensitive"),m=e.querySelector("#wb-whole-word"),x=e.querySelector("#wb-use-regex");i.addEventListener("click",(function(){w.checked=!w.checked,i.classList.toggle("active",w.checked),C()})),r.addEventListener("click",(function(){m.checked=!m.checked,r.classList.toggle("active",m.checked),C()})),a.addEventListener("click",(function(){x.checked=!x.checked,a.classList.toggle("active",x.checked),C()})),b.addEventListener("input",(function(){C()})),o.addEventListener("click",(function(){k()})),s.addEventListener("click",(function(){E()})),l.addEventListener("click",(function(){L()})),u.addEventListener("click",(function(){S("prev")})),d.addEventListener("click",(function(){S("next")})),h.addEventListener("click",(function(){C()})),b.addEventListener("keypress",(function(e){13===e.which&&k()}));var k=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1;if(c){C();var t=b.value;if(t){var i=w.checked,r=x.checked,a=m.checked;try{var o,s=c.getContent({format:"raw"});if(r)o=new RegExp(t,i?"g":"gi");else{var l=t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");o=a?new RegExp("\\b".concat(l,"\\b"),i?"g":"gi"):new RegExp(l,i?"g":"gi")}var u=s.match(o),d=u?u.length:0;if(d>0){var h=s.replace(o,(function(e){return'<mark class="wb-search-highlight">'.concat(e,"</mark>")}));c.setContent(h,{format:"raw"}),g.style.display="block",g.querySelector(".result-count").innerHTML="".concat(v("共")," ").concat(d," ").concat(v("个匹配项")),n.lastSearchText=t,n.lastSearchOptions={caseSensitive:i,useRegex:r,wholeWord:a},S("next",e)}else g.style.display="none",p.toast(v("未找到匹配项"))}catch(e){console.error(e),p.toast(v("搜索错误，请检查语法"))}}else p.toast(v("请输入搜索内容"))}else p.toast(v("Magicpost: 未能识别内容"))},S=function(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1;if(c&&n.lastSearchText)try{var r=c.getContent({format:"raw"}),a=t(r.matchAll(/<mark class="wb-search-highlight(?: current)?">(.*?)<\/mark>/g));if(0===a.length)return void k();var o,s=i>-1?i:n.currentResultIndex;o="next"===e?(s+1)%a.length:(s-1+a.length)%a.length;var l=c.dom.select(".wb-search-highlight.current");l.length>0&&l[0].classList.remove("current");var u=c.dom.select(".wb-search-highlight")[o];u.classList.add("current"),u&&c.selection.scrollIntoView(u),n.currentResultIndex=o,y.innerHTML=v("第")+(o+1)+v("项，")}catch(e){console.error("导航错误:",e),p.toast(v("导航错误"))}else p.toast(v("请先执行搜索"))},E=function(){var e=f.value,t=c.getContent({format:"raw"});if(n.currentResultIndex>-1){c.dom.select(".wb-search-highlight.current")[0].innerHTML=e;var i=n.currentResultIndex-1;k(i)}else try{var r;if(n.lastSearchOptions.useRegex)r=new RegExp(n.lastSearchText,n.lastSearchOptions.caseSensitive?"":"i");else{var a=n.lastSearchText.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");r=n.lastSearchOptions.wholeWord?new RegExp("\\b".concat(a,"\\b"),n.lastSearchOptions.caseSensitive?"":"i"):new RegExp(a,n.lastSearchOptions.caseSensitive?"":"i")}var o=t.replace(r,e);o!==t?(c.setContent(o,{format:"raw"}),p.toast(v("已替换1处内容")),k()):p.toast(v("未找到匹配内容"))}catch(e){console.error(e),p.toast(v("替换错误，请检查语法"))}},C=function(){n.clearHighlight(),g&&(g.style.display="none"),n.currentResultIndex=-1,n.searchResults=[]},L=function(){var e=b.value,t=f.value;if(e){var i=w.checked,r=x.checked,a=m.checked;try{var o,s=c.getContent({format:"raw"});if(r)o=new RegExp(e,i?"g":"gi");else{var l=e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");o=a?new RegExp("\\b".concat(l,"\\b"),i?"g":"gi"):new RegExp(l,i?"g":"gi")}var u=s.match(o),d=u?u.length:0;if(d>0){var h=s.replace(/<mark class="wb-search-highlight">(.*?)<\/mark>/g,"$1"),g=(h=h.replace(/<mark class="wb-search-highlight current">(.*?)<\/mark>/g,"$1")).replace(o,t);c.setContent(g,{format:"raw"}),p.toast(v("替换完成，共替换 ".concat(d," 处")))}else p.toast(v("未找到匹配内容"));document.querySelector("#wb-search-results-info").style.display="none",n.clearHighlight()}catch(e){console.error(e),p.toast(v("替换错误，请检查语法")),n.clearHighlight()}}else p.toast(v("请输入搜索内容"))}},clearHighlight:function(){var e=this,t=e.getMCE();if(t)try{var n=t.getContent({format:"raw"}),c=n.replace(/<mark class="wb-search-highlight">(.*?)<\/mark>/g,"$1");n!==(c=c.replace(/<mark class="wb-search-highlight current">(.*?)<\/mark>/g,"$1"))&&t.setContent(c,{format:"raw"})}catch(e){console.error("清除高亮错误:",e)}e.searchResults=[],e.currentResultIndex=-1},getMCE:function(){return"undefined"!=typeof tinyMCE&&tinyMCE.activeEditor},getContent:function(){var e="undefined"!=typeof tinyMCE&&tinyMCE.activeEditor;return e&&!e.hidden?e.getContent({format:"raw"}):"undefined"!=typeof wpActiveEditor?document.querySelector("#"+wpActiveEditor).value:document.querySelector("#content")?document.querySelector("#content").value:""},setContent:function(e,t){var n="undefined"!=typeof tinyMCE&&tinyMCE.activeEditor;if(n&&!n.hidden)n.setContent(e,{format:"raw"});else if("undefined"!=typeof wpActiveEditor)document.querySelector("#"+wpActiveEditor).value=e;else{if(!document.querySelector("#content"))return void console.log(v("Magicpost: 未能识别编辑器"));document.querySelector("#content").value=e}"function"==typeof t&&t()}};function v(e){return"undefined"!=typeof wb_i18n_magicpost&&wb_i18n_magicpost[e]?wb_i18n_magicpost[e]:e}document.addEventListener("DOMContentLoaded",(function(){void 0!==b&&b.init()}))})();