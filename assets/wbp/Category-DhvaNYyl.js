import{u as e,a,c as l,V as t,ac as s,s as o,o as u,a1 as n,K as c,a5 as i,e as r,g as p,l as d,J as v,i as b,t as m,k as _,w as f,P as y,M as h,a3 as g,ad as w,a6 as k,a7 as V,ae as C,aa as x,d as z,f as j,F as D,h as S,af as U,ag as q,j as P,a8 as R}from"./wbs-CbbGGF9c.js";import{E as T,a as I,b as O}from"./el-table-column-BFsxvqL9.js";import{E as B,a as E}from"./el-select-Dy7NI8A6.js";import"./el-popper-aeiKbmSs.js";import"./el-checkbox-t6DShoFv.js";import"./strings-lvuBHTJ0.js";const K={class:"wbs-main"},A={key:0,class:"wb-section setting-box"},F={class:"sc-main"},J={class:"sc-title"},M={class:"log-box"},G=["data-label"],H=["href"],L=["data-label"],N=["data-label"],Q={class:"btns-bar with-ctrl-area"},W={class:"wb-ctrl-area"},X={class:"sc-side"},Y={class:"sc-title"},Z={class:"log-box"},$={key:0,class:"getpro-mask"},ee={class:"mask-inner"},ae={class:"tips"},le={key:1,class:"mt"},te={__name:"Category",setup(te){const{wbsCnf:se}=e(),{wb_e:oe}=a(se),ue=k(),ne=l(!1),ce=l(!1),ie=l(0),re=t({}),pe=t({post_type:"post",post_status:"",cat:"",keyword:"",query_child:"lv1"}),de=l(""),ve=l([]),be=l(0),me=l(1),_e=l(30),fe=l([]),ye=l([]),he=t({publish:oe("已发布"),draft:oe("草稿"),pending:oe("待审核"),future:oe("计划")}),ge=s("sourceDataTableRef"),we=o((()=>re.cat_table&&pe.post_type&&re.cat_table[pe.post_type]?re.cat_table[pe.post_type]:[]));function ke(){de.value&&("none"===de.value?ge.value&&ge.value.clearSelection():(ge.value&&ge.value.clearSelection(),ge.value&&ge.value.toggleAllSelection()))}function Ve(){pe.cat=""}function Ce(e,a){if(!ie.value)return void C.alert(oe("该功能需要激活PRO版本"),oe("提示"),{confirmButtonText:oe("去激活"),callback:e=>{ue.push("/pro")}});if(fe.value.length<1)return void x.warning(oe("请选择文章"));if(ye.value.length<1)return void x.warning(oe("请选择目标分类"));let l=fe.value.map((e=>e.ID)),t=ye.value.map((e=>e.cat_ID));C.confirm(a,oe("确认执行如下动作?"),{confirmButtonText:oe("确定"),cancelButtonText:oe("取消")}).then((()=>{const a={op:"move_cat",type:e,tax:re.cat_tax[pe.post_type],post:l.join(","),cat:t.join(","),batch_op:de.value};g.saveData(a).then((()=>{x.success(oe("设置成功")),de.value="",ge.value&&ge.value.clearSelection(),De()}))}))}function xe(e){ye.value=e}function ze(e){fe.value=e}function je(e){me.value=e,Se()}function De(){me.value=1,Se()}function Se(){ie.value&&(ne.value=!0,g.getData({op:"move_query",page:me.value,num:_e.value,tax:re.cat_tax&&pe.post_type?re.cat_tax[pe.post_type]:"",q:pe}).then((e=>{ne.value=!1,ve.value=e.data,be.value=e.total})))}function Ue(e){_e.value=e,Se()}return u((()=>{se.is_pro?n(((e,a)=>{e?ie.value=e:(ie.value=0,se.is_pro=0)})):(ne.value=!1,ce.value=!0),g.getData({op:"move_cnf"}).then((e=>{if(Object.assign(re,e.cnf),re.post_type)for(let a in re.post_type){pe.post_type=a;break}ce.value=!0}))})),(e,a)=>{const l=E,t=B,s=U,o=V,u=w,n=O,g=T,k=I,C=R,x=z("wbs-ctrl-bar"),te=i;return c((j(),r("div",{class:h(["wbs-content-inner full",{"wb-page-loaded":ce.value}])},[p("div",K,[ce.value?(j(),r("div",A,[p("div",F,[p("h3",J,m(_(oe)("原分类")),1),b(u,null,{default:f((()=>[b(t,{class:"ctrl-item w8em",size:"small",modelValue:pe.post_type,"onUpdate:modelValue":a[0]||(a[0]=e=>pe.post_type=e),placeholder:_(oe)("文章类型"),onChange:Ve,clearable:"",filterable:""},{default:f((()=>[(j(!0),r(D,null,S(re.post_type,((e,a)=>(j(),d(l,{key:"o-s-t-"+a,label:e,value:a},null,8,["label","value"])))),128))])),_:1},8,["modelValue","placeholder"]),b(t,{class:"ctrl-item w8em",size:"small",modelValue:pe.post_status,"onUpdate:modelValue":a[1]||(a[1]=e=>pe.post_status=e),placeholder:_(oe)("文章状态"),clearable:"",filterable:""},{default:f((()=>[(j(!0),r(D,null,S(he,((e,a)=>(j(),d(l,{key:"o-s-p-"+a,label:e,value:a},null,8,["label","value"])))),128))])),_:1},8,["modelValue","placeholder"]),b(t,{class:"ctrl-item",size:"small",modelValue:pe.cat,"onUpdate:modelValue":a[2]||(a[2]=e=>pe.cat=e),placeholder:_(oe)("文章分类"),clearable:"",filterable:""},{default:f((()=>[(j(!0),r(D,null,S(we.value,(e=>(j(),d(l,{key:e.cat_ID,label:"— ".repeat(1*e.lv)+e.name,value:e.cat_ID},null,8,["label","value"])))),128))])),_:1},8,["modelValue","placeholder"]),b(t,{class:"ctrl-item w8em",size:"small",modelValue:pe.query_child,"onUpdate:modelValue":a[3]||(a[3]=e=>pe.query_child=e),placeholder:_(oe)("包含范围"),filterable:""},{default:f((()=>[(j(!0),r(D,null,S({lv1:_(oe)("仅当前分类"),lvn:_(oe)("含子分类")},((e,a)=>(j(),d(l,{key:"o-s-pc-"+a,label:e,value:a},null,8,["label","value"])))),128))])),_:1},8,["modelValue","placeholder"]),b(s,{class:"ctrl-item wbs-input-short",clearable:"",modelValue:pe.keyword,"onUpdate:modelValue":a[4]||(a[4]=e=>pe.keyword=e),placeholder:_(oe)("请输入内容"),onKeyup:q(De,["enter","native"])},null,8,["modelValue","placeholder"]),b(o,{type:"primary",class:"ctrl-item",onClick:De},{default:f((()=>[P(m(_(oe)("搜索")),1)])),_:1})])),_:1}),p("div",M,[c((j(),d(g,{ref:"sourceDataTableRef",class:"wbs-table mt","table-layout":"auto",data:ve.value,style:{width:"100%"},onSelectionChange:ze},{default:f((()=>[b(n,{type:"selection",width:"55"}),b(n,{label:_(oe)("文章名称")},{default:f((({row:e})=>[p("div",{"data-label":_(oe)("文章名称")},[p("a",{href:e.post_link,target:"_blank"},m(e.post_title),9,H)],8,G)])),_:1},8,["label"]),b(n,{label:_(oe)("分类"),"class-name":"w20"},{default:f((({row:e})=>[p("div",{"data-label":_(oe)("分类")},[p("span",null,m(e.post_category.join("、")),1)],8,L)])),_:1},8,["label"]),b(n,{label:_(oe)("发布日期"),"class-name":"w20"},{default:f((({row:e})=>[p("div",{"data-label":_(oe)("发布日期")},m(e.post_date),9,N)])),_:1},8,["label"])])),_:1},8,["data"])),[[te,ne.value]]),c(p("div",Q,[p("div",W,[b(t,{clearable:"",onChange:ke,placeholder:_(oe)("批量选择"),modelValue:de.value,"onUpdate:modelValue":a[5]||(a[5]=e=>de.value=e)},{default:f((()=>[b(l,{label:_(oe)("清除选中"),value:"none"},null,8,["label"]),b(l,{label:_(oe)("选中当前页项"),value:"page"},null,8,["label"]),b(l,{label:_(oe)("选中所有结果项"),value:"all"},null,8,["label"])])),_:1},8,["placeholder","modelValue"])]),b(k,{background:"",layout:_(se).is_mobile?"pager, total, prev, next":"total, sizes, prev, pager, next, jumper","page-size":_e.value,"onUpdate:pageSize":a[6]||(a[6]=e=>_e.value=e),total:1*be.value,"pager-count":5,"current-page":me.value,"onUpdate:currentPage":a[7]||(a[7]=e=>me.value=e),onCurrentChange:je,"page-sizes":[10,30,50,100],onSizeChange:Ue},null,8,["layout","page-size","total","current-page"])],512),[[y,ve.value.length>0]])])]),p("div",X,[p("h3",Y,m(_(oe)("目标分类")),1),p("div",Z,[b(g,{data:we.value,"tooltip-effect":"dark",onSelectionChange:xe,style:{width:"100%"}},{default:f((()=>[b(n,{type:"selection",width:"55"}),b(n,{label:_(oe)("分类")},{default:f((({row:e})=>[P(m("— ".repeat(1*e.lv))+" "+m(e.name),1)])),_:1},8,["label"]),b(n,{prop:"count",label:_(oe)("文章数"),width:"100"},null,8,["label"])])),_:1},8,["data"])])]),ie.value?v("",!0):(j(),r("div",$,[p("div",ee,[b(o,{type:"primary",onClick:a[8]||(a[8]=e=>{ue.push("/pro")})},{default:f((()=>[P(m(_(oe)("获取PRO版本")),1)])),_:1}),p("p",ae,"* "+m(_(oe)("激活PRO版本即可使用")),1)])]))])):v("",!0),c(b(C,{class:"mt"},null,512),[[y,ce.value]]),_(se).is_mobile?(j(),r("div",le,[p("div",null,[b(o,{style:{display:"block",width:"100%"},onClick:a[9]||(a[9]=e=>Ce(1,_(oe)("重置文章分类为目标分类")))},{default:f((()=>[P(m(_(oe)("重置文章分类为目标分类")),1)])),_:1})]),p("div",null,[b(o,{class:"mt",style:{display:"block",width:"100%"},onClick:a[10]||(a[10]=e=>Ce(2,_(oe)("添加目标分类至文章"))),type:"primary"},{default:f((()=>[P(m(_(oe)("添加目标分类至文章")),1)])),_:1})]),p("div",null,[b(o,{class:"mt",style:{display:"block",width:"100%"},onClick:a[11]||(a[11]=e=>Ce(3,_(oe)("将文章从目标分类移出"))),type:"success"},{default:f((()=>[P(m(_(oe)("将文章从目标分类移出")),1)])),_:1})])])):v("",!0)]),_(se).is_mobile?v("",!0):(j(),d(x,{key:0},{default:f((()=>[b(o,{size:"large",onClick:a[12]||(a[12]=e=>Ce(1,_(oe)("重置文章分类为目标分类")))},{default:f((()=>[P(m(_(oe)("重置文章分类为目标分类")),1)])),_:1}),b(o,{size:"large",onClick:a[13]||(a[13]=e=>Ce(2,_(oe)("添加目标分类至文章"))),type:"primary"},{default:f((()=>[P(m(_(oe)("添加目标分类至文章")),1)])),_:1}),b(o,{size:"large",onClick:a[14]||(a[14]=e=>Ce(3,_(oe)("将文章从目标分类移出"))),type:"success"},{default:f((()=>[P(m(_(oe)("将文章从目标分类移出")),1)])),_:1})])),_:1}))],2)),[[te,!ce.value]])}}};export{te as default};
