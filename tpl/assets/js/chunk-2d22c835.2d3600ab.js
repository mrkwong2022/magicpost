(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2d22c835"],{f40a:function(t,a,e){"use strict";e.r(a);var s=function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("div",{directives:[{name:"loading",rawName:"v-loading",value:!t.isLoaded,expression:"!isLoaded"}],staticClass:"wbs-content-inner full",class:{"wb-page-loaded":t.isLoaded}},[e("div",{staticClass:"wbs-main"},[e("div",{staticClass:"wb-section setting-box"},[e("div",{staticClass:"sc-main"},[e("h3",{staticClass:"sc-title"},[t._v("原标签")]),e("div",{staticClass:"wbs-ctrl-bar"},[e("el-select",{staticClass:"ctrl-item w8em",attrs:{size:"small",clearable:"",placeholder:"文章类型"},on:{change:t.changeType},model:{value:t.q.post_type,callback:function(a){t.$set(t.q,"post_type",a)},expression:"q.post_type"}},t._l(t.cnf.post_type,(function(t,a){return e("el-option",{key:"o-s-t-"+a,attrs:{label:t,value:a}})})),1),e("el-select",{staticClass:"ctrl-item w8em",attrs:{size:"small",placeholder:"文章状态",clearable:""},model:{value:t.q.post_status,callback:function(a){t.$set(t.q,"post_status",a)},expression:"q.post_status"}},t._l(t.post_status,(function(t,a){return e("el-option",{key:"o-s-p-"+a,attrs:{label:t,value:a}})})),1),e("el-select",{staticClass:"ctrl-item",attrs:{size:"small",placeholder:"文章分类",clearable:""},model:{value:t.q.cat,callback:function(a){t.$set(t.q,"cat",a)},expression:"q.cat"}},t._l(t.cat_list,(function(t){return e("el-option",{key:t.cat_ID,attrs:{label:"— ".repeat(1*t.lv)+t.name,value:t.cat_ID}})})),1),e("el-select",{staticClass:"ctrl-item w8em",attrs:{size:"small",placeholder:"包含范围"},model:{value:t.q.query_child,callback:function(a){t.$set(t.q,"query_child",a)},expression:"q.query_child"}},t._l({lv1:"仅当前分类",lvn:"含子分类"},(function(t,a){return e("el-option",{key:"o-s-pc-"+a,attrs:{label:t,value:a}})})),1),e("el-input",{staticClass:"ctrl-item w8em",attrs:{size:"small",clearable:"",placeholder:"标签名称或别名"},model:{value:t.q.tag,callback:function(a){t.$set(t.q,"tag",a)},expression:"q.tag"}}),e("el-input",{staticClass:"ctrl-item wbs-input-short",attrs:{size:"small",clearable:"",placeholder:"请输入文章标题"},nativeOn:{keyup:function(a){return!a.type.indexOf("key")&&t._k(a.keyCode,"enter",13,a.key,"Enter")?null:t.searchPost()}},model:{value:t.q.keyword,callback:function(a){t.$set(t.q,"keyword",a)},expression:"q.keyword"}}),e("el-button",{staticClass:"ctrl-item",attrs:{type:"primary",size:"small",clearable:""},on:{click:function(a){return t.searchPost()}}},[t._v("搜索")]),t.$cnf.is_mobile?e("div",{staticClass:"switch-btn",on:{click:t.toggle_panel}},[t.isExpanded?e("div",[e("i",{staticClass:"el-icon-arrow-up"}),t._v(" "),e("span",[t._v("收起面板")])]):e("div",[e("i",{staticClass:"el-icon-search"}),t._v(" "),e("span",[t._v("筛选")])])]):t._e()],1),e("div",{staticClass:"log-box"},[e("el-table",{ref:"sourceDataTable",staticClass:"wbs-table mt",staticStyle:{width:"100%"},attrs:{data:t.list},on:{"selection-change":t.handleSelection}},[e("el-table-column",{attrs:{type:"selection",width:"55"}}),e("el-table-column",{attrs:{label:"文章"},scopedSlots:t._u([{key:"default",fn:function(a){return[e("div",{attrs:{"data-label":"文章"}},[e("span",{staticClass:"url"},[t._v(t._s(a.row.post_title))])])]}}])}),e("el-table-column",{attrs:{label:"标签","class-name":"w45"},scopedSlots:t._u([{key:"default",fn:function(a){return[e("div",{attrs:{"data-label":"标签"}},[e("span",[t._v(t._s(a.row.post_category.join("、")))])])]}}])})],1),e("div",{directives:[{name:"show",rawName:"v-show",value:t.list.length>0,expression:"list.length > 0"}],staticClass:"btns-bar with-ctrl-area"},[e("div",{staticClass:"wb-ctrl-area"},[e("el-select",{attrs:{size:"small",clearable:"",placeholder:"批量选择"},on:{change:t.batchOpChange},model:{value:t.batch_op,callback:function(a){t.batch_op=a},expression:"batch_op"}},[e("el-option",{attrs:{label:"清除选中",value:"none"}}),e("el-option",{attrs:{label:"选中当前页项",value:"page"}}),e("el-option",{attrs:{label:"选中所有结果项",value:"all"}})],1)],1),e("el-pagination",{attrs:{background:"",layout:t.$cnf.is_mobile?"pager, total, prev, next":"total, prev, pager, next, jumper","page-size":t.num,total:1*t.total,"pager-count":5,"current-page":t.page},on:{"current-change":t.nav_page}})],1)],1)]),e("div",{staticClass:"sc-main"},[e("h3",{staticClass:"sc-title"},[t._v("目标标签")]),e("div",{staticClass:"wbs-ctrl-bar"},[e("el-input",{staticClass:"ctrl-item wbs-input-short",attrs:{size:"small",clearable:"",placeholder:"请输入标签名称、别名"},nativeOn:{keyup:function(a){return!a.type.indexOf("key")&&t._k(a.keyCode,"enter",13,a.key,"Enter")?null:t.searchTag2()}},model:{value:t.q2.keyword,callback:function(a){t.$set(t.q2,"keyword",a)},expression:"q2.keyword"}}),e("el-button",{staticClass:"ctrl-item",attrs:{type:"primary",size:"small"},on:{click:function(a){return t.searchTag2()}}},[t._v("搜索")]),e("el-button",{staticClass:"ctrl-item",attrs:{type:"primary fr",size:"small",plain:"",icon:"el-icon-circle-plus-outline"},on:{click:function(a){t.addDialogVisible=!0}}},[t._v("添加标签")]),t.$cnf.is_mobile?e("div",{staticClass:"switch-btn",on:{click:t.toggle_panel}},[t.isExpanded?e("div",[e("i",{staticClass:"el-icon-arrow-up"}),t._v(" "),e("span",[t._v("收起面板")])]):e("div",[e("i",{staticClass:"el-icon-search"}),t._v(" "),e("span",[t._v("筛选")])])]):t._e()],1),e("div",{staticClass:"log-box"},[e("el-table",{staticClass:"wbs-table mt",staticStyle:{width:"100%"},attrs:{data:t.list2},on:{"selection-change":t.handleSelection2}},[e("el-table-column",{attrs:{type:"selection",width:"55"}}),e("el-table-column",{attrs:{label:"名称"},scopedSlots:t._u([{key:"default",fn:function(a){return[e("div",{attrs:{"data-label":"名称"}},[e("span",[t._v(t._s(a.row.name))])])]}}])}),e("el-table-column",{attrs:{label:"文章数","class-name":"w25"},scopedSlots:t._u([{key:"default",fn:function(a){return[e("div",{attrs:{"data-label":"文章数"}},[t._v(t._s(a.row.count))])]}}])})],1),e("div",{directives:[{name:"show",rawName:"v-show",value:t.list2.length>0,expression:"list2.length > 0"}],staticClass:"btns-bar"},[e("el-pagination",{attrs:{background:"",layout:t.$cnf.is_mobile?"pager, total, prev, next":"total, prev, pager, next, jumper","page-size":t.num2,total:1*t.total2,"pager-count":5,"current-page":t.page2},on:{"current-change":t.nav_page2}})],1)],1)]),t.isPro?t._e():e("div",{staticClass:"getpro-mask"},[e("div",{staticClass:"mask-inner"},[e("el-button",{attrs:{type:"primary",size:"small"},on:{click:function(a){return t.doActivePro()}}},[t._v("获取PRO版本")]),e("p",{staticClass:"tips"},[t._v("* 激活PRO版本即可使用")])],1)])]),e("wb-prompt",{directives:[{name:"show",rawName:"v-show",value:t.isLoaded,expression:"isLoaded"}],staticClass:"mt"}),t.$cnf.is_mobile?e("div",{staticClass:"mt"},[e("div",[e("el-button",{staticStyle:{display:"block",width:"100%"},attrs:{size:"medium"},on:{click:function(a){return t.setPost(3,"移除文章中的目标标签")}}},[t._v("移除文章中的目标标签")])],1),e("div",{staticClass:"mt"},[e("el-button",{staticStyle:{display:"block",width:"100%"},attrs:{size:"medium",type:"primary"},on:{click:function(a){return t.setPost(4,"新增目标标签至文章")}}},[t._v("新增目标标签至文章")])],1)]):t._e()],1),t.$cnf.is_mobile?t._e():e("div",{staticClass:"wbs-footer"},[e("div",{staticClass:"wbsf-inner"},[e("el-row",[e("el-button",{on:{click:function(a){return t.setPost(3,"移除文章中的目标标签")}}},[t._v("移除文章中的目标标签")]),e("el-button",{attrs:{type:"primary"},on:{click:function(a){return t.setPost(4,"新增目标标签至文章")}}},[t._v("新增目标标签至文章")])],1)],1)]),e("el-dialog",{attrs:{title:"编辑标签","modal-append-to-body":!1,visible:t.editDialogVisible},on:{"update:visible":function(a){t.editDialogVisible=a}}},[e("div",[t._v(" 名称 "),e("el-input",{attrs:{placeholder:"请输入名称"},model:{value:t.tag_name,callback:function(a){t.tag_name=a},expression:"tag_name"}})],1),e("div",{staticClass:"mt"},[t._v(" 别名 "),e("el-input",{attrs:{placeholder:"请输入别名"},model:{value:t.tag_slug,callback:function(a){t.tag_slug=a},expression:"tag_slug"}})],1),e("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e("el-button",{on:{click:function(a){t.editDialogVisible=!1}}},[t._v("取 消")]),e("el-button",{attrs:{type:"primary"},on:{click:t.updateTag}},[t._v("确 定")])],1)]),e("el-dialog",{attrs:{title:"新增标签","modal-append-to-body":!1,visible:t.addDialogVisible},on:{"update:visible":function(a){t.addDialogVisible=a}}},[e("div",[t._v(" 名称 "),e("el-input",{attrs:{placeholder:"请输入名称"},model:{value:t.new_tag_name,callback:function(a){t.new_tag_name=a},expression:"new_tag_name"}})],1),e("div",{staticClass:"mt"},[t._v(" 别名 "),e("el-input",{attrs:{placeholder:"请输入别名"},model:{value:t.new_tag_slug,callback:function(a){t.new_tag_slug=a},expression:"new_tag_slug"}})],1),e("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e("el-button",{on:{click:function(a){t.addDialogVisible=!1}}},[t._v("取 消")]),e("el-button",{attrs:{type:"primary"},on:{click:t.addNewTag}},[t._v("确 定")])],1)])],1)},l=[],o={name:"MagicPostMoveTag",components:{},data(){const t=this;return{loading:0,editDialogVisible:!1,addDialogVisible:!1,wb_cnf:t.$cnf,isLoaded:!1,isPro:0,opt:{},cnf:{cat_table:{}},q:{post_type:"post",post_status:"",cat:"",keyword:"",tag_id:"",tag:"",query_child:"lv1"},q2:{keyword:"",tag_id:""},list:[],total:0,page:1,num:30,list2:[],total2:0,page2:1,num2:30,pos:"s",batch_op:"",selectTag:[],selectTag2:[],tag_name:"",tag_slug:"",edit_tag:null,new_tag_name:"",new_tag_slug:"",post_status:{publish:"已发布",draft:"草稿",pending:"待审核",future:"计划"},isExpanded:!1}},created(){const t=this;t.$cnf.is_pro&&t.$verify((a,e)=>{console.log([a,e]),a?t.isPro=a:(t.isPro=0,t.$cnf.is_pro=0)}),this.loadData()},computed:{cat_list(){const t=this;return t.cnf.cat_table[t.q.post_type]}},methods:{batchOpChange(){const t=this;t.batch_op&&("none"==t.batch_op?t.$refs.sourceDataTable.clearSelection():(t.$refs.sourceDataTable.clearSelection(),t.$refs.sourceDataTable.toggleAllSelection()))},addNewTag(){const t=this;t.new_tag_name?t.isPro&&t.$wbui.confirm("确认添加标签？",(function(){const a={_ajax_nonce:t.$cnf._ajax_nonce,action:t.$cnf.action.act,op:"move_new_tag",post_type:t.q.post_type,tax:t.cnf.cat_tax[t.q.post_type],name:t.new_tag_name,slug:t.new_tag_slug};t.$api.saveData(a).then(a=>{a["code"]?t.$wbui.toast("添加出错了，"+a["desc"]):(t.addDialogVisible=!1,t.$wbui.toast("添加成功"),t.q2.keyword=t.new_tag_name,t.page2=1,t.searchTag2(),t.new_tag_name="",t.new_tag_slug="")})})):t.$wbui.toast("名称不能为空")},editTag(t,a){const e=this;e.edit_tag=t,e.tag_name=t.name,e.tag_slug=t.slug,e.editDialogVisible=!0,e.pos=a},updateTag(){const t=this;t.tag_name?t.tag_slug?t.isPro&&t.$wbui.confirm("确认更新标签？",(function(){const a={_ajax_nonce:t.$cnf._ajax_nonce,action:t.$cnf.action.act,op:"move_update_tag",post_type:t.q.post_type,tax:t.cnf.cat_tax[t.q.post_type],id:t.edit_tag.term_id,name:t.tag_name,slug:t.tag_slug};t.$api.saveData(a).then(a=>{a["code"]?t.$wbui.toast("更新出错了，"+a["desc"]):(t.editDialogVisible=!1,t.$wbui.toast("更新成功"),setTimeout(()=>{"t"==t.pos?t.searchTag2():t.searchTag()},250))})})):t.$wbui.toast("别名不能为空"):t.$wbui.toast("名称不能为空")},deleteTag(t,a){const e=this;e.$wbui.confirm("确认删除标签 "+t.name+"？",(function(){const s={_ajax_nonce:e.$cnf._ajax_nonce,action:e.$cnf.action.act,op:"move_del_tag",post_type:e.q.post_type,tax:e.cnf.cat_tax[e.q.post_type],id:t.term_id};e.isPro&&e.$api.saveData(s).then(t=>{e.$wbui.toast("删除成功"),"t"==a?e.searchTag2():e.searchTag()})}))},setPost(t,a){const e=this;if(e.selectTag.length<1)return void e.$wbui.toast("未选择文章");if(e.selectTag2.length<1)return void e.$wbui.toast("未选择目标标签");if(!e.isPro)return;let s=[],l=[];e.selectTag.forEach((function(t,a){s.push(t.ID)})),console.log(s),e.selectTag2.forEach((function(t,a){l.push(t.term_id)})),console.log(l),e.$wbui.confirm("确认"+a+"？",(function(){const a={_ajax_nonce:e.$cnf._ajax_nonce,action:e.$cnf.action.act,op:"move_tag",type:t,post_type:e.q.post_type,tax:e.cnf.cat_tax[e.q.post_type],source:s.join(","),target:l.join(","),batch_op:e.batch_op};e.$api.saveData(a).then(t=>{e.$wbui.toast("设置成功"),e.batch_op="",e.$refs.sourceDataTable.clearSelection()})}))},handleSelection(t){this.selectTag=t},handleSelection2(t){this.selectTag2=t},nav_page(t){this.page=t,this.searchPost()},nav_page2(t){this.page2=t,this.getData("t")},changeType(){console.log(this.q),this.q.cat=""},searchPost(){const t=this;t.isPro&&(console.log([t.q,t.total,t.page,t.num]),console.log(t.q),t.loading=t.$wbui.loading(),t.$api.getData({_ajax_nonce:t.$cnf._ajax_nonce,action:t.$cnf.action.act,op:"move_tag_post_query",page:t.page,num:t.num,tax:t.cnf.cat_tax[t.q.post_type],tax2:t.cnf.cat_tax2[t.q.post_type],q:t.q,total:t.total}).then(a=>{t.$wbui.close(t.loading),t.list=a["data"],t.total=a["total"]}))},searchTag(){const t=this;t.page=1,t.getData("s")},searchTag2(){const t=this;t.page2=1,t.getData("t")},getData(t){const a=this;if(!a.isPro)return;console.log([a.q,a.total,a.page,a.num]),a.loading=a.$wbui.loading();let e={_ajax_nonce:a.$cnf._ajax_nonce,action:a.$cnf.action.act,op:"move_tag_query",pos:t,page:a.page,num:a.num,tax:a.cnf.cat_tax[a.q.post_type],q:a.q,total:a.total};"t"==t&&(a.q2.post_type=a.q.post_type,e.q=a.q2,e.page=a.page2,e.num=a.num2,e.total=a.total2),a.$api.getData(e).then(e=>{a.$wbui.close(a.loading),"t"==t?(a.list2=e["data"],a.total2=e["total"]):(a.list=e["data"],a.total=e["total"])})},loadData(){const t=this;t.$api.getData({_ajax_nonce:t.$cnf._ajax_nonce,action:t.$cnf.action.act,op:"move_tag_cnf"}).then(a=>{if(t.cnf=a.cnf,t.cnf.post_type)for(let e in t.cnf.post_type){t.q.post_type=e;break}t.isLoaded=!0})},toggle_panel(){const t=this;t.$el.querySelector(".wbs-ctrl-bar").classList.toggle("expand"),t.isExpanded=!t.isExpanded}}},n=o,i=e("2877"),c=Object(i["a"])(n,s,l,!1,null,null,null);a["default"]=c.exports}}]);